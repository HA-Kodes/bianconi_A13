<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Users</title>
</head>
<body>
    <h1>Users</h1>

    <!-- List view: multiple users -->
    <div th:unless="${#lists.size(users) == 1}" th:each="user : ${users}">
        <p>
            <a th:href="@{'/users/' + ${user.userId}}" th:text="${user.userId}">User ID</a><br/>
            <span th:text="${user.username}">Username</span><br/>
            <span th:text="${user.name}">Name</span><br/>
            <span th:text="${user.password}">Password</span><br/>
            <div th:each="account : ${user.accounts}">
                <span th:text="${account.accountName}">Account Name</span>
            </div>
        </p>
        <hr/>
    </div>

    <!-- Detail view: single user -->
    <div th:if="${#lists.size(users) == 1}">
        <form th:object="${user}" th:action="@{'/users/' + ${user.userId}}" method="post">
            <div>
                Username: <input type="text" th:field="*{username}" />
            </div>
            <div>
                Password: <input type="password" th:field="*{password}" />
            </div>
            <div>
                Full Name: <input type="text" th:field="*{name}" />
            </div>

            <!-- Address block -->
            <div th:if="${user.address != null}">
                <h3>Address</h3>
                <input type="text" th:field="*{address.addressLine1}" placeholder="Address Line 1" />
                <input type="text" th:field="*{address.addressLine2}" placeholder="Address Line 2" />
                <input type="text" th:field="*{address.city}" placeholder="City" />
                <input type="text" th:field="*{address.region}" placeholder="Region" />
                <input type="text" th:field="*{address.country}" placeholder="Country" />
                <input type="text" th:field="*{address.zipCode}" placeholder="Zip Code" />
            </div>

            <div>
                <input type="submit" value="Update User Account" />
            </div>
        </form>

        <!-- Delete user -->
        <form th:action="@{/users/{userId}/delete(userId=${user.userId})}" method="post">
            <input type="submit" value="Delete User Account" />
        </form>

        <!-- Accounts -->
        <h3>Accounts</h3>
        <ul>
            <li th:each="account : ${user.accounts}">
                <a th:href="@{'/users/' + ${user.userId} + '/accounts/' + ${account.accountId}}"
                   th:text="${account.accountName}">Account Name</a>
                <!-- Optional delete button -->
                <!-- <form th:action="@{'/users/' + ${user.userId} + '/accounts/' + ${account.accountId} + '/delete'}" method="post">
                    <button type="submit">Delete</button>
                </form> -->
            </li>
        </ul>

        <!-- Create new account -->
        <form th:action="@{'/users/' + ${user.userId} + '/accounts'}" method="post">
            <button type="submit">Create New Bank Account</button>
        </form>

        <!-- Back link -->
        <a th:href="@{/users}">Back</a>
    </div>
</body>
</html>